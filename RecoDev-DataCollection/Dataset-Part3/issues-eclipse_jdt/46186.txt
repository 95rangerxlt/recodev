TestCase:

public class TestClass {
	
	public TestClass() {
	}
	
	public TestClass(int i) {
	}
	
	public static void main(String[] args) {
		TestClass t= new TestClass();
		TestClass t1= new TestClass(10);
	}
}

- select new TestClass(10)
- introduce factory
- you get the exception below

- the problem is that edits generated by one rewiter can't be easily combined. 
The code should be written in the following way:

- create rewriter
- do all modification to the rewriter without rewriting the node
- do the rewriting at the end of the try block for all modifications.
- to group modifications so that the preview will look nice a group
  descriptions can to be passed to the ASTRewrite methods (e.g mark*(ASTNode,
  GroupDescription).
- add all used group descriptions at the end to the change object .

====================== the exception ==============================
java.lang.reflect.InvocationTargetException
	at java.lang.Throwable.<init>(Throwable.java)
	at java.lang.Throwable.<init>(Throwable.java:104)
	at java.lang.reflect.InvocationTargetException.<init>
(InvocationTargetException.java:66)
	at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:283)
	at org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.run
(RefactoringWizardDialog2.java:271)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.createChange
(RefactoringWizard.java:377)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.computeUserInputSucce
ssorPage(RefactoringWizard.java:297)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.computeUserInputSucce
ssorPage(RefactoringWizard.java:293)
	at 
org.eclipse.jdt.internal.ui.refactoring.UserInputWizardPage.getNextPage
(UserInputWizardPage.java:79)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.previewPressed
(RefactoringWizardDialog2.java:418)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.access$3
(RefactoringWizardDialog2.java:416)
	at org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2
$1.widgetSelected(RefactoringWizardDialog2.java:547)
	at org.eclipse.swt.widgets.TypedListener.handleEvent
(TypedListener.java)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)
	at org.eclipse.jface.window.Window.runEventLoop(Window.java)
	at org.eclipse.jface.window.Window.open(Window.java:563)
	at 
org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate
(RefactoringStarter.java:56)
	at com.ibm.watson.refactoring.actions.IntroduceFactoryAction.run
(IntroduceFactoryAction.java:108)
	at org.eclipse.ui.internal.PluginAction.runWithEvent
(PluginAction.java:265)
	at 
org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection
(ActionContributionItem.java:547)
	at org.eclipse.jface.action.ActionContributionItem.access$4
(ActionContributionItem.java:494)
	at org.eclipse.jface.action.ActionContributionItem$6.handleEvent
(ActionContributionItem.java:466)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)
	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1571)
	at org.eclipse.ui.internal.Workbench.run(Workbench.java:1554)
	at org.eclipse.core.internal.boot.InternalBootLoader.run
(InternalBootLoader.java:858)
	at org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:79)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:41)
	at java.lang.reflect.Method.invoke(Method.java:386)
	at org.eclipse.core.launcher.Main.basicRun(Main.java:299)
	at org.eclipse.core.launcher.Main.run(Main.java:765)
	at org.eclipse.core.launcher.Main.main(Main.java:599)
Caused by: org.eclipse.text.edits.MalformedTreeException: Overlapping text 
edits
	at java.lang.Throwable.<init>(Throwable.java)
	at java.lang.Throwable.<init>(Throwable.java)
	at org.eclipse.text.edits.MalformedTreeException.<init>
(MalformedTreeException.java:35)
	at org.eclipse.text.edits.TextEdit$InsertionComparator.compare
(TextEdit.java:113)
	at java.util.Collections.indexedBinarySearch(Collections.java:323)
	at java.util.Collections.binarySearch(Collections.java:311)
	at org.eclipse.text.edits.TextEdit.computeInsertionIndex
(TextEdit.java:692)
	at org.eclipse.text.edits.TextEdit.internalAdd(TextEdit.java:679)
	at org.eclipse.text.edits.TextEdit.addChild(TextEdit.java:275)
	at 
com.ibm.watson.refactoring.IntroduceFactoryRefactoring.addAllChangesFor
(IntroduceFactoryRefactoring.java:948)
	at com.ibm.watson.refactoring.IntroduceFactoryRefactoring.createChange
(IntroduceFactoryRefactoring.java:1047)
	at org.eclipse.jdt.internal.ui.refactoring.CreateChangeOperation.run
(CreateChangeOperation.java:104)
	at org.eclipse.jface.operation.ModalContext$ModalContextThread.run
(ModalContext.java:101)

TestCase:

public class TestClass {
	
	public TestClass() {
	}
	
	public TestClass(int i) {
	}
	
	public static void main(String[] args) {
		TestClass t= new TestClass();
		TestClass t1= new TestClass(10);
	}
}

- select new TestClass(10)
- introduce factory
- you get the exception below

- the problem is that edits generated by one rewiter can't be easily combined. 
The code should be written in the following way:

- create rewriter
- do all modification to the rewriter without rewriting the node
- do the rewriting at the end of the try block for all modifications.
- to group modifications so that the preview will look nice a group
  descriptions can to be passed to the ASTRewrite methods (e.g mark*(ASTNode,
  GroupDescription).
- add all used group descriptions at the end to the change object .

====================== the exception ==============================
java.lang.reflect.InvocationTargetException
	at java.lang.Throwable.<init>(Throwable.java)
	at java.lang.Throwable.<init>(Throwable.java:104)
	at java.lang.reflect.InvocationTargetException.<init>
(InvocationTargetException.java:66)
	at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:283)
	at org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.run
(RefactoringWizardDialog2.java:271)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.createChange
(RefactoringWizard.java:377)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.computeUserInputSucce
ssorPage(RefactoringWizard.java:297)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizard.computeUserInputSucce
ssorPage(RefactoringWizard.java:293)
	at 
org.eclipse.jdt.internal.ui.refactoring.UserInputWizardPage.getNextPage
(UserInputWizardPage.java:79)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.previewPressed
(RefactoringWizardDialog2.java:418)
	at 
org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2.access$3
(RefactoringWizardDialog2.java:416)
	at org.eclipse.jdt.internal.ui.refactoring.RefactoringWizardDialog2
$1.widgetSelected(RefactoringWizardDialog2.java:547)
	at org.eclipse.swt.widgets.TypedListener.handleEvent
(TypedListener.java)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)
	at org.eclipse.jface.window.Window.runEventLoop(Window.java)
	at org.eclipse.jface.window.Window.open(Window.java:563)
	at 
org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate
(RefactoringStarter.java:56)
	at com.ibm.watson.refactoring.actions.IntroduceFactoryAction.run
(IntroduceFactoryAction.java:108)
	at org.eclipse.ui.internal.PluginAction.runWithEvent
(PluginAction.java:265)
	at 
org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection
(ActionContributionItem.java:547)
	at org.eclipse.jface.action.ActionContributionItem.access$4
(ActionContributionItem.java:494)
	at org.eclipse.jface.action.ActionContributionItem$6.handleEvent
(ActionContributionItem.java:466)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java)
	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1571)
	at org.eclipse.ui.internal.Workbench.run(Workbench.java:1554)
	at org.eclipse.core.internal.boot.InternalBootLoader.run
(InternalBootLoader.java:858)
	at org.eclipse.core.boot.BootLoader.run(BootLoader.java:461)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:79)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:41)
	at java.lang.reflect.Method.invoke(Method.java:386)
	at org.eclipse.core.launcher.Main.basicRun(Main.java:299)
	at org.eclipse.core.launcher.Main.run(Main.java:765)
	at org.eclipse.core.launcher.Main.main(Main.java:599)
Caused by: org.eclipse.text.edits.MalformedTreeException: Overlapping text 
edits
	at java.lang.Throwable.<init>(Throwable.java)
	at java.lang.Throwable.<init>(Throwable.java)
	at org.eclipse.text.edits.MalformedTreeException.<init>
(MalformedTreeException.java:35)
	at org.eclipse.text.edits.TextEdit$InsertionComparator.compare
(TextEdit.java:113)
	at java.util.Collections.indexedBinarySearch(Collections.java:323)
	at java.util.Collections.binarySearch(Collections.java:311)
	at org.eclipse.text.edits.TextEdit.computeInsertionIndex
(TextEdit.java:692)
	at org.eclipse.text.edits.TextEdit.internalAdd(TextEdit.java:679)
	at org.eclipse.text.edits.TextEdit.addChild(TextEdit.java:275)
	at 
com.ibm.watson.refactoring.IntroduceFactoryRefactoring.addAllChangesFor
(IntroduceFactoryRefactoring.java:948)
	at com.ibm.watson.refactoring.IntroduceFactoryRefactoring.createChange
(IntroduceFactoryRefactoring.java:1047)
	at org.eclipse.jdt.internal.ui.refactoring.CreateChangeOperation.run
(CreateChangeOperation.java:104)
	at org.eclipse.jface.operation.ModalContext$ModalContextThread.run
(ModalContext.java:101)
Appends when using I20030929 as a base build
The change creation code is now following the recommended practice suggested in 
the original bug report (thanks Dirk!).
