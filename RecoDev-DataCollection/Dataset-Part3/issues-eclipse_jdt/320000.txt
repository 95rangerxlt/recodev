Fix for bug 277574 in 3.4.x stream.

Fix for bug 277574 in 3.4.x stream.
Created attachment 174409
patch

This patch backports several fixes to the ASTInstuctionCompiler including:

bug 277574
bug 318333 
bug 304757 
bug 244263
bug 273633
bug 275486
Released to 3.4 maintenance branch.
