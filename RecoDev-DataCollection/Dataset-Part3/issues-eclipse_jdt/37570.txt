Small bit of code to show how it fails.
If you start with a plugin class as generated by the PDE, enter this after the 
getWorkspace() method:
   public IResource findByName(final String name) {
      IProject[] projectList = getWorkspace().getRoot().getProjects();

      IResourceProxyVisitor myVisitor = new IResourceProxyVisitor() {
         public boolean visit(IResourceProxy proxy) throws CoreException {
            // TODO Auto-generated method stub
            return false;
         }
      }; 
      return foundResource;
   }

Then save.  All is ok.

Format the source - I then see:
   public IResource findByName(final String name) {
      IProject[] projectList = getWorkspace().getRoot().getProjects();

      IResourceProxyVisitor myVisitor = new IResourceProxyVisitor() {
         public boolean visit(IResourceProxy proxy) throws CoreException {
               // TODO Auto-generated method stub
   return false;
         }
      };
      return foundResource;
   }
Note how the // TODO is indented while return false; is not.
Still saves without errors.

Place cursor in the visit method, choose the refactor > Convert anonymous class 
to nested... option; enter a name for the class and say ok.

Errors.  Code created is :
   private final class NField implements IResourceProxyVisitor {
      public boolean visit(IResourceProxy proxy) throws CoreException {
            // TODO Auto-generated method stub
      eturn false;
      }
   }
Note missing r on eturn false;

Different scenarios give similar results (some statement looses a char).  
Formatting seems to be the culprit, error not triggered if formatting not 
requested. Formatting is visually incorrect and this then bothers the refactor.

Small bit of code to show how it fails.
If you start with a plugin class as generated by the PDE, enter this after the 
getWorkspace() method:
   public IResource findByName(final String name) {
      IProject[] projectList = getWorkspace().getRoot().getProjects();

      IResourceProxyVisitor myVisitor = new IResourceProxyVisitor() {
         public boolean visit(IResourceProxy proxy) throws CoreException {
            // TODO Auto-generated method stub
            return false;
         }
      }; 
      return foundResource;
   }

Then save.  All is ok.

Format the source - I then see:
   public IResource findByName(final String name) {
      IProject[] projectList = getWorkspace().getRoot().getProjects();

      IResourceProxyVisitor myVisitor = new IResourceProxyVisitor() {
         public boolean visit(IResourceProxy proxy) throws CoreException {
               // TODO Auto-generated method stub
   return false;
         }
      };
      return foundResource;
   }
Note how the // TODO is indented while return false; is not.
Still saves without errors.

Place cursor in the visit method, choose the refactor > Convert anonymous class 
to nested... option; enter a name for the class and say ok.

Errors.  Code created is :
   private final class NField implements IResourceProxyVisitor {
      public boolean visit(IResourceProxy proxy) throws CoreException {
            // TODO Auto-generated method stub
      eturn false;
      }
   }
Note missing r on eturn false;

Different scenarios give similar results (some statement looses a char).  
Formatting seems to be the culprit, error not triggered if formatting not 
requested. Formatting is visually incorrect and this then bothers the refactor.
Adam, please investigate.
for the incorrect formatting see bug 37609
reproduced with the following class
public class F {
	public void foo() {
		F foo= new F() {
			public void bar() {
					// TODO Auto-generated method stub
	return;
			}
		};
	}
}
i added a test to my suite (disabled until this is fixed)
Martin, i use the rewriter here and that must be the culprit
fixed > 20030514
confirmed
i enabled my regression test, so we should never see this one again
