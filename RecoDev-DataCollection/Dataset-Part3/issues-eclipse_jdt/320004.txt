Fixes to the AST instruction compiler, follow from bug 277574.

Fixes to the AST instruction compiler, follow from bug 277574.
Created attachment 174410
patch

Updates to the AST instruction compiler containing fixes for:

bug 277574
bug 318333
bug 304757
bug 244263
Released to 3.5.2+
