This is a clone of the bug 296343 for 3.3.2+ release.

This is a clone of the bug 296343 for 3.3.2+ release.
Created attachment 155546
Proposed fix + regression test for 3.3 maintenance
Released in 3.3 maintenance.
