+++ This bug was initially created as a clone of Bug #983927 +++

Changes since last update:
#4437 Fixes corrupted by Aspose fonts
#4444 Estimate the size of decoded streams in advance.
#4451 Makes firefox extension's l10n get() behavior similar to webL10n
#4426 Making extensions/chromium/*.js adhere to the style guide
#4434 Jbig2 optimizations
#4460 Fix coding style in external/builder/builder.js
#4465 Fix coding style in src/display
#4467 Fix coding style in /test
#4468 Fix coding style in make.js
#4454 Fix gaia css lint errors.
#4463 Fix copy-paste typo
#4473 Prevent infinite loop in CFFParser_parseHeader
#4477 Fixes HiDPI icons of the secondary toolbar for Chrome
#4440 refactor src/core/pdf_manager.js: rename pdfModel to pdfDocument
#4470 CMaps binary packing
#4447 Allocate fewer objects
#4464 Fixes pages without Resources in their dictionary
#4481 refactor src/core/pdf_manager.js: rename pdfModel to pdfDocument
#4488 Sync pt-BR translations with l10n-mozilla-aurora
#4474 Introduce paintSolidColorImageMask command to handle 1x1 solid image
#4453 Add a cache for glyphs
#4478 Use a vanilla array for fnArray
#4452 Making src/core/{image,obj,parser}.js adhere to the style guide
#4493 Fixes ignoring of the escaped CR LF
#4497 jpgjs performance improvements
#4503 Fix coding style in src/core/fonts.js
#4508 Fix coding style in extensions/firefox
#4507 Fix coding style in src/core
#4505 Making src/core/evaluator.js adhere to the style guide
#4509 Update lint config to enforce braces for single line statements
#4501 [Firefox] Lazy load network.js in PdfStreamConverter.js
#4517 Fixes for small colour variations in tests
#4511 Fix for #3181: jbig2 encoding for number of instances greater than 1
#4518 [Firefox] Stop importing default_preferences.js as a module and include it instead
#4466 Faster 1 bpp image drawing
#4504 Import l10n files from mozilla-aurora
#4525 [Firefox] Only load 'PdfStreamConverter' and 'PdfRedirector' when PDF.js is enabled
#4527 Partially reverts #3641
#4519 Cleaning up the viewer and pdfbug; fixes bugs in Stepper
#4515 Replaces test.py with test.js
#4529 Fix error message typo
#4521 Assign non-zero width/height to all rectangles (issue 4260)
#4541 Cools down Chrome/Windows during testing
#4543 Fixes lint for windows; adds test/font/fontutils.js
#4542 Fix typo/unused argument in fontloader.js->spliceString()

+++ This bug was initially created as a clone of Bug #983927 +++

Changes since last update:
#4437 Fixes corrupted by Aspose fonts
#4444 Estimate the size of decoded streams in advance.
#4451 Makes firefox extension's l10n get() behavior similar to webL10n
#4426 Making extensions/chromium/*.js adhere to the style guide
#4434 Jbig2 optimizations
#4460 Fix coding style in external/builder/builder.js
#4465 Fix coding style in src/display
#4467 Fix coding style in /test
#4468 Fix coding style in make.js
#4454 Fix gaia css lint errors.
#4463 Fix copy-paste typo
#4473 Prevent infinite loop in CFFParser_parseHeader
#4477 Fixes HiDPI icons of the secondary toolbar for Chrome
#4440 refactor src/core/pdf_manager.js: rename pdfModel to pdfDocument
#4470 CMaps binary packing
#4447 Allocate fewer objects
#4464 Fixes pages without Resources in their dictionary
#4481 refactor src/core/pdf_manager.js: rename pdfModel to pdfDocument
#4488 Sync pt-BR translations with l10n-mozilla-aurora
#4474 Introduce paintSolidColorImageMask command to handle 1x1 solid image
#4453 Add a cache for glyphs
#4478 Use a vanilla array for fnArray
#4452 Making src/core/{image,obj,parser}.js adhere to the style guide
#4493 Fixes ignoring of the escaped CR LF
#4497 jpgjs performance improvements
#4503 Fix coding style in src/core/fonts.js
#4508 Fix coding style in extensions/firefox
#4507 Fix coding style in src/core
#4505 Making src/core/evaluator.js adhere to the style guide
#4509 Update lint config to enforce braces for single line statements
#4501 [Firefox] Lazy load network.js in PdfStreamConverter.js
#4517 Fixes for small colour variations in tests
#4511 Fix for #3181: jbig2 encoding for number of instances greater than 1
#4518 [Firefox] Stop importing default_preferences.js as a module and include it instead
#4466 Faster 1 bpp image drawing
#4504 Import l10n files from mozilla-aurora
#4525 [Firefox] Only load 'PdfStreamConverter' and 'PdfRedirector' when PDF.js is enabled
#4527 Partially reverts #3641
#4519 Cleaning up the viewer and pdfbug; fixes bugs in Stepper
#4515 Replaces test.py with test.js
#4529 Fix error message typo
#4521 Assign non-zero width/height to all rectangles (issue 4260)
#4541 Cools down Chrome/Windows during testing
#4543 Fixes lint for windows; adds test/font/fontutils.js
#4542 Fix typo/unused argument in fontloader.js->spliceString()
Created attachment 8400366
Update pdf.js to version 0.8.1334
Comment on attachment 8400366
Update pdf.js to version 0.8.1334

r? Mossop for the PdfStreamConverter.jsm change
Created attachment 8400590
cmaplicense.diff
Comment on attachment 8400590
cmaplicense.diff

r=gerv, except "AdobeCMap" comes _after_ "ACE" and "acorn". And can we have it lower case? I know ACE is wrong, but still.

Thanks,

Gerv
Created attachment 8400632
cmaplicense2.diff

(In reply to Gervase Markham [:gerv] from comment #4)
> Comment on attachment 8400590
> cmaplicense.diff
> 
> r=gerv, except "AdobeCMap" comes _after_ "ACE" and "acorn". And can we have
> it lower case? I know ACE is wrong, but still.

Done. Thanks
Comment on attachment 8400366
Update pdf.js to version 0.8.1334

Review of attachment 8400366:
-----------------------------------------------------------------

::: browser/extensions/pdfjs/content/PdfJs.jsm
@@ +64,5 @@
> +var DEFAULT_PREFERENCES = {
> +  showPreviousViewOnLoad: true,
> +  defaultZoomValue: '',
> +  ifAvailableShowOutlineOnLoad: false
> +};

The incorrect indentation here should be corrected.
>The incorrect indentation here should be corrected.

This is another case where the code is included from a preprocessor. See https://github.com/mozilla/pdf.js/blob/master/extensions/firefox/content/PdfJs.jsm#L63
https://hg.mozilla.org/integration/fx-team/rev/e1d196155712
https://hg.mozilla.org/integration/fx-team/rev/dce94f2f8124
https://hg.mozilla.org/mozilla-central/rev/e1d196155712
https://hg.mozilla.org/mozilla-central/rev/dce94f2f8124
