https://tbpl.mozilla.org/php/getParsedLog.php?id=32885282&tree=Mozilla-Inbound
Windows 7 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-12 00:40:40 PST for push d5d5fb7cb469
slave: t-w732-ix-010

01:05:10     INFO -  TEST-START | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
01:05:10     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | we have the header node
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "XUL box for hbox element contained an inline span child, forcing all its children to be wrapped in a block." {file: "resource://gre/modules/commonjs/toolkit/loader.js -> resource://gre/modules/devtools/server/actors/highlighter.js" line: 335}]
01:05:10  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
01:05:10     INFO -  Stack trace:
01:05:10     INFO -      JS frame :: chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js :: performTestComparisons :: line 72
01:05:10     INFO -      JS frame :: chrome://mochikit/content/browser-test.js :: testScope/test_executeSoon/<.run :: line 734
01:05:10     INFO -      native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'top'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'left'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'top'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'left'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:11     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | correct output for $0

https://tbpl.mozilla.org/php/getParsedLog.php?id=32885282&tree=Mozilla-Inbound
Windows 7 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-12 00:40:40 PST for push d5d5fb7cb469
slave: t-w732-ix-010

01:05:10     INFO -  TEST-START | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
01:05:10     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | we have the header node
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "XUL box for hbox element contained an inline span child, forcing all its children to be wrapped in a block." {file: "resource://gre/modules/commonjs/toolkit/loader.js -> resource://gre/modules/devtools/server/actors/highlighter.js" line: 335}]
01:05:10  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
01:05:10     INFO -  Stack trace:
01:05:10     INFO -      JS frame :: chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js :: performTestComparisons :: line 72
01:05:10     INFO -      JS frame :: chrome://mochikit/content/browser-test.js :: testScope/test_executeSoon/<.run :: line 734
01:05:10     INFO -      native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'top'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'left'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'top'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:10     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | Console message: [JavaScript Warning: "Error in parsing value for 'left'.  Declaration dropped." {file: "chrome://browser/content/devtools/spectrum-frame.xhtml" line: 0 column: 0 source: "NaNpx"}]
01:05:11     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | correct output for $0
https://tbpl.mozilla.org/php/getParsedLog.php?id=32881394&tree=Mozilla-Inbound
Tomcat
https://tbpl.mozilla.org/php/getParsedLog.php?id=32906706&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound opt test mochitest-browser-chrome on 2014-01-12 22:51:12
revision: c4bb238b15bb
slave: t-w864-ix-046

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=32926312&tree=Mozilla-Central
Windows XP 32-bit mozilla-central pgo test mochitest-browser-chrome on 2014-01-13 08:52:29
revision: 80a27198344a
slave: t-xp32-ix-120

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
KWierso
https://tbpl.mozilla.org/php/getParsedLog.php?id=32947309&tree=Fx-Team
Rev5 MacOSX Mountain Lion 10.8 fx-team opt test mochitest-browser-chrome on 2014-01-13 16:53:39
revision: 4382db6e0a52
slave: talos-mtnlion-r5-008

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=32927683&tree=Holly
WINNT 6.2 holly pgo test mochitest-browser-chrome on 2014-01-13 09:24:46
revision: 8b90142c4760
slave: t-w864-ix-106

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=32980109&tree=Mozilla-Central
Windows XP 32-bit mozilla-central opt test mochitest-browser-chrome on 2014-01-14 08:04:59
revision: b9131831154f
slave: t-xp32-ix-064

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
KWierso
https://tbpl.mozilla.org/php/getParsedLog.php?id=33002603&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-14 17:41:45
revision: def1c895cd80
slave: t-xp32-ix-041

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
I've started to investigate this. It's not failing locally of course, so I've added many logs and pushed to try again several times, but so far haven't reproduced the failure.
RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=33059121&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-15 14:25:50
revision: 0964f977345e
slave: t-xp32-ix-014

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Tomcat
https://tbpl.mozilla.org/php/getParsedLog.php?id=33090594&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-16 01:40:49
revision: f017ae03bb6c
slave: t-xp32-ix-078

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33128493&tree=Mozilla-Central
Windows XP 32-bit mozilla-central pgo test mochitest-browser-chrome on 2014-01-16 14:32:59
revision: e44ba69207be
slave: t-xp32-ix-021

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Gijs
https://tbpl.mozilla.org/php/getParsedLog.php?id=33123152&tree=Try
Windows XP 32-bit try opt test mochitest-browser-chrome on 2014-01-16 12:55:58
revision: e6ec225174a3
slave: t-xp32-ix-048

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=33177479&tree=Fx-Team
Windows XP 32-bit fx-team opt test mochitest-browser-chrome on 2014-01-17 08:41:31
revision: ff7083dc49b4
slave: t-xp32-ix-104

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Gijs
https://tbpl.mozilla.org/php/getParsedLog.php?id=33176950&tree=Try
Windows XP 32-bit try opt test mochitest-browser-chrome on 2014-01-17 08:39:22
revision: d8255af62d5f
slave: t-xp32-ix-112

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=33178027&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound opt test mochitest-browser-chrome on 2014-01-17 08:57:29
revision: 648a54eeed19
slave: talos-mtnlion-r5-036

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
KWierso
https://tbpl.mozilla.org/php/getParsedLog.php?id=33191083&tree=Mozilla-Central
Windows XP 32-bit mozilla-central opt test mochitest-browser-chrome on 2014-01-17 13:05:41
revision: fad7172d4542
slave: t-xp32-ix-055

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Gijs
https://tbpl.mozilla.org/php/getParsedLog.php?id=33197572&tree=Try
Windows XP 32-bit try opt test mochitest-browser-chrome on 2014-01-17 15:12:55
revision: 3d14839886a8
slave: t-xp32-ix-113

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33206160&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound opt test mochitest-browser-chrome on 2014-01-17 18:00:24
revision: 48289161bc17
slave: talos-mtnlion-r5-050

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
ttaubert
https://tbpl.mozilla.org/php/getParsedLog.php?id=33220150&tree=Fx-Team
Windows XP 32-bit fx-team pgo test mochitest-browser-chrome on 2014-01-18 03:00:42
revision: 72c4c3be4360
slave: t-xp32-ix-090

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
froydnj
https://tbpl.mozilla.org/php/getParsedLog.php?id=33217905&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound opt test mochitest-browser-chrome on 2014-01-18 00:15:41
revision: 1f72556326be
slave: talos-mtnlion-r5-024

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33222100&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound pgo test mochitest-browser-chrome on 2014-01-18 04:17:51
revision: b07b7fca7f6c
slave: t-xp32-ix-012

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33224368&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound opt test mochitest-browser-chrome on 2014-01-18 05:01:04
revision: f8c14bd80676
slave: t-xp32-ix-006

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33231075&tree=Mozilla-Inbound
Windows XP 32-bit mozilla-inbound pgo test mochitest-browser-chrome on 2014-01-18 08:40:28
revision: cc0ba35ea087
slave: t-xp32-ix-124

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33227048&tree=Mozilla-Central
Windows XP 32-bit mozilla-central pgo test mochitest-browser-chrome on 2014-01-18 06:05:44
revision: 298f262f21ff
slave: t-xp32-ix-110

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Patrick, is it possible this test regressed with the landing of bug 916443 ? Landing date seems close enough...
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=33234853&tree=Mozilla-Central
Windows XP 32-bit mozilla-central pgo test mochitest-browser-chrome on 2014-01-18 14:07:45
revision: b3c08e6fa790
slave: t-xp32-ix-071

TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting
Return code: 1
Yes Mihai, I changed this test during the course of bug 916443, to adapt it to the new highlighter.
So it is related.
I have a feeling this bug is due to the CSS animation normally applied to our highlighter.
It's normally disabled during tests, but it was not the case in this one.
I'll push to try and see.
Thanks!
Created attachment 8362518
bug958966-intermittent-webconsole-highlighter.patch

Mihai, this test is failing because the highlighter is not shown predictably due to the CSS animation.
This test isn't about the highlighter at all (there are other tests for that) but instead about selecting a node for setting the value of $0.
So I removed the part dealing with checking the highlighter.
Ongoing try build seems to be pretty green so far: https://tbpl.mozilla.org/?tree=Try&rev=1a864078a310
Comment on attachment 8362518
bug958966-intermittent-webconsole-highlighter.patch

Review of attachment 8362518:
-----------------------------------------------------------------

Looks good. Let's hope this fixes the intermittent failure. Thanks!

::: browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
@@ +55,5 @@
> +    executeSoon(() => {
> +      EventUtils.synthesizeMouseAtCenter(h1, {}, content);
> +      inspector.toolbox.once("picker-stopped", () => {
> +        info("Picker mode stopped, H1 selected, now switching to the console");
> +        openConsole(gBrowser.selectedTab, performWebConsoleTests);

nit: openConsole(gBrowser.selectedTab).then(performWebConsoleTests)

(trying to phase-out the callback)
Created attachment 8362658
bug958966-intermittent-webconsole-highlighter v2.patch

Thanks Mihai for the review.
Yeah, let's hope this will fix it, but judging by the number of green bcs in the green try, I'm pretty sure it will.
Attaching a v2 of this patch with the only change being the .then() you mentioned.
Fixed in fx-team: https://hg.mozilla.org/integration/fx-team/rev/e81c56e83687
https://hg.mozilla.org/mozilla-central/rev/e81c56e83687


Intermittent browser_webconsole_bug_653531_highlighter_console_helper.js | inspector is highlighting

intermittent-failure

Bug 958966 - Fix intermittent browser_webconsole_bug_653531_highlighter_console_helper.js due to highlighter not shown, r=msucan 