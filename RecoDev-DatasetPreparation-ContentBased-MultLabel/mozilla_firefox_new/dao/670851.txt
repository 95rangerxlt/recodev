If I make uncaught exceptions in browser-chrome mochitests cause test failures, browser_bug519216.js fails as follows:

TEST-START | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | called progressListener1 before progressListener2
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | called progressListener2 before progressListener3
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | didn't call progressListener4 for the first location change
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
INFO TEST-END | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | finished in 64ms

If I make uncaught exceptions in browser-chrome mochitests cause test failures, browser_bug519216.js fails as follows:

TEST-START | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | called progressListener1 before progressListener2
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | called progressListener2 before progressListener3
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | didn't call progressListener4 for the first location change
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
INFO TEST-END | chrome://mochitests/content/browser/browser/base/content/test/browser_bug519216.js | finished in 64ms
browser_popupNotification.js causes this exception too:

...
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #12] added listeners; panel state: false
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #12] running test
before 561152, after 524288, break 0980e000
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #12] popup showing
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #12] popup shown
before 561152, after 520192, break 0980e000
before 561152, after 528384, break 0980e000
before 561152, after 520192, break 0980e000
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #12] popup hidden (0 hides remaining)
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | Should only have hidden the notification after 3 page loads
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | removal callback triggered
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #13] added listeners; panel state: false
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #13] running test
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | Console message: [JavaScript Error: "[Exception... "Component returned failure code: 0x80004002 (NS_NOINTERFACE) [nsIWebProgress.DOMWindow]"  nsresult: "0x80004002 (NS_NOINTERFACE)"  location: "JS frame :: chrome://browser/content/browser.js :: <TOP_LEVEL> :: line 9655"  data: no]" {file: "chrome://browser/content/tabbrowser.xml" line: 414}]
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | Console message: [JavaScript Error: "this.mBrowser is undefined" {file: "chrome://browser/content/tabbrowser.xml" line: 639}]
before 561152, after 528384, break 0980e000
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #13] popup showing
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #13] popup shown
before 561152, after 520192, break 0980e000
before 561152, after 528384, break 0980e000
before 561152, after 536576, break 0980e000
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #13] popup hidden (0 hides remaining)
TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | Should only have hidden the notification after the timeout was passed
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #14] added listeners; panel state: false
TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_popupNotification.js | [Test #14] running test
...

As does browser/components/places/tests/browser/browser_library_middleclick.js:

TEST-START | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | PlacesUtils in context
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | PlacesUIUtils in context
TEST-INFO | unknown test url |  - before wait for focus -- loaded: uninitialized active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) about:blank child window: ([object ChromeWindow]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - must wait for load
TEST-INFO | unknown test url |  - must wait for focus
TEST-INFO | unknown test url |  - waitForEvent called <type:load, target[object XULDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:false> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - waitForEvent called <type:focus, target[object XULDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Start of test: Open bookmark in a new tab.
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We correctly have selection in the Library left pane
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Found bookmark in the right pane
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - already focused
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Warning: "Use of getAttributeNode() is deprecated. Use getAttribute() instead." {file: "chrome://browser/content/places/places.xul" line: 0}]
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We have opened 1 new tab(s)
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Tab has been opened in current browser window
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | about:buildconfig
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Opened URI found in list: about:buildconfig
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - already focused
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.mBrowser is undefined" {file: "chrome://browser/content/tabbrowser.xml" line: 639}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Start of test: Open a folder in tabs.
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We correctly have selection in the Library left pane
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Found folder in the right pane
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - must wait for focus
TEST-INFO | unknown test url |  - waitForEvent called <type:focus, target[object XULDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Tab has been opened in current browser window
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We have opened 2 new tab(s)
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Tab has been opened in current browser window
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "uncaught exception: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNode :: line 388"  data: no]"]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "uncaught exception: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNode :: line 388"  data: no]"]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "The api has changed. A places view should be passed to PUIU_openContainerInTabs. Not passing a view will throw in a future release." {file: "resource:///modules/PlacesUIUtils.jsm" line: 845}]
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | about:buildconfig
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Opened URI found in list: about:buildconfig
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | about:
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Opened URI found in list: about:
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - must wait for focus
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
TEST-INFO | unknown test url |  - waitForEvent called <type:focus, target[object HTMLDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.mBrowser is undefined" {file: "chrome://browser/content/tabbrowser.xml" line: 639}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Start of test: Open a query in tabs.
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We correctly have selection in the Library left pane
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Found query in the right pane
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - must wait for focus
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | unknown test url |  - waitForEvent called <type:focus, target[object XULDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/places/places.xul child window: ([object ChromeWindow]) chrome://browser/content/places/places.xul docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.docShell is null" {file: "chrome://global/content/bindings/browser.xml" line: 0}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Tab has been opened in current browser window
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | We have opened 2 new tab(s)
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Tab has been opened in current browser window
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "uncaught exception: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNode :: line 388"  data: no]"]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_delete command: [Exception... "Component returned failure code: 0x80070057 (NS_ERROR_ILLEGAL_VALUE) [nsINavHistoryContainerResultNode.getChild]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/treeView.js :: PTV__getNodeForRow :: line 259"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "uncaught exception: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNode :: line 388"  data: no]"]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "The api has changed. A places view should be passed to PUIU_openContainerInTabs. Not passing a view will throw in a future release." {file: "resource:///modules/PlacesUIUtils.jsm" line: 845}]
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | about:buildconfig
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Opened URI found in list: about:buildconfig
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | about:
TEST-PASS | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Opened URI found in list: about:
TEST-INFO | unknown test url |  - before wait for focus -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/places/places.xul focused window: ([object ChromeWindow]) chrome://browser/content/places/places.xul desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - must wait for focus
NEXT ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | [SimpleTest/SimpleTest.js, window.onerror] - An error occurred: this.mBrowser is undefined at chrome://browser/content/tabbrowser.xml:639
TEST-INFO | unknown test url |  - waitForEvent called <type:focus, target[object HTMLDocument]> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | unknown test url |  - maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow]) chrome://browser/content/browser.xul focused window: ([object Window]) about:blank desired window: ([object ChromeWindow]) chrome://browser/content/browser.xul child window: ([object Window]) about:blank docshell visible: true
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "this.mBrowser is undefined" {file: "chrome://browser/content/tabbrowser.xml" line: 639}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_cut command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_selectedNodes :: line 301"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
TEST-INFO | chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_library_middleclick.js | Console message: [JavaScript Error: "An error occurred updating the cmd_paste command: [Exception... "'Illegal value' when calling method: [nsINavHistoryResultTreeViewer::nodeForTreeIndex]"  nsresult: "0x80070057 (NS_ERROR_ILLEGAL_VALUE)"  location: "JS frame :: chrome://browser/content/places/tree.xml :: get_insertionPoint :: line 444"  data: no]" {file: "chrome://global/content/globalOverlay.js" line: 86}]
...
Created attachment 545539
patch

I could add a this.mBrowser check after the code calling external progress listeners, but removing a tab in the middle of this seems like it should generally be avoided anyway, as it could break other listeners...
Comment on attachment 545539
patch

The executeSoon could also be put in doOnPopupEvent, but perhaps that would cause other issues (I think popupshowing isn't fired async).
Created attachment 545543
patch

missed browser_library_middleclick.js :\
http://hg.mozilla.org/mozilla-central/rev/52437f6bd6b0


browser_bug519216.js, browser_popupNotification.js and browser_library_middleclick.js cause exception in tabbrowser.xml



Bug 670851 - browser_bug519216.js, browser_popupNotification.js and browser_library_middleclick.js cause exception in tabbrowser.xml. r=gavin 