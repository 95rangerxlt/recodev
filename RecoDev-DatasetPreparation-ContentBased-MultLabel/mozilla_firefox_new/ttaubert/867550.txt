https://tbpl.mozilla.org/php/getParsedLog.php?id=22439899&tree=Mozilla-Inbound

Rev3 Fedora 12 mozilla-inbound debug test mochitest-browser-chrome on 2013-04-30 16:58:12 PDT for push c5715eab8805
slave: talos-r3-fed-065

17:00:19     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Running test
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Health Reporter instance available.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Searches provider is available.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have data for today.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have data for about home on this engine.
17:00:19  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have searches recorded. - Got 1, expected 2
17:00:19     INFO -  Stack trace:
17:00:19     INFO -      JS frame :: chrome://mochikit/content/browser-test.js :: test_is :: line 527
17:00:19     INFO -      JS frame :: chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js :: onValues :: line 153
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/HealthReport.jsm :: onSuccess :: line 3256
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/HealthReport.jsm :: onSuccess :: line 3182
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Task.jsm :: TaskImpl_run :: line 220
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Task.jsm :: TaskImpl_run :: line 217
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Sqlite.jsm :: onResult :: line 494
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Sqlite.jsm :: <TOP_LEVEL> :: line 805
17:00:19     INFO -      native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0
17:00:19     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Cleanup

https://tbpl.mozilla.org/php/getParsedLog.php?id=22439899&tree=Mozilla-Inbound

Rev3 Fedora 12 mozilla-inbound debug test mochitest-browser-chrome on 2013-04-30 16:58:12 PDT for push c5715eab8805
slave: talos-r3-fed-065

17:00:19     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Running test
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Health Reporter instance available.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Searches provider is available.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have data for today.
17:00:19     INFO -  TEST-PASS | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have data for about home on this engine.
17:00:19  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have searches recorded. - Got 1, expected 2
17:00:19     INFO -  Stack trace:
17:00:19     INFO -      JS frame :: chrome://mochikit/content/browser-test.js :: test_is :: line 527
17:00:19     INFO -      JS frame :: chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js :: onValues :: line 153
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/HealthReport.jsm :: onSuccess :: line 3256
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/HealthReport.jsm :: onSuccess :: line 3182
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Task.jsm :: TaskImpl_run :: line 220
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Task.jsm :: TaskImpl_run :: line 217
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Sqlite.jsm :: onResult :: line 494
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 120
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: then :: line 45
17:00:19     INFO -      JS frame :: resource://gre/modules/commonjs/sdk/core/promise.js :: resolve :: line 187
17:00:19     INFO -      JS frame :: resource://gre/modules/Sqlite.jsm :: <TOP_LEVEL> :: line 805
17:00:19     INFO -      native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0
17:00:19     INFO -  TEST-INFO | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Cleanup
philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=24642137&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test mochitest-browser-chrome on 2013-06-26 16:57:41
revision: f857417260a9
slave: talos-r4-snow-019

17:00:07  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have searches recorded. - Got 1, expected 2
KWierso
https://tbpl.mozilla.org/php/getParsedLog.php?id=25151089&tree=Mozilla-Inbound
Rev4 MacOSX Lion 10.7 mozilla-inbound debug test mochitest-browser-chrome on 2013-07-10 16:56:45
revision: 365723243b79
slave: talos-r4-lion-065

17:00:00  WARNING -  TEST-UNEXPECTED-FAIL | chrome://mochitests/content/browser/browser/base/content/test/browser_aboutHome.js | Have searches recorded. - Got 1, expected 2
The test always breaks around 17:00 PDT, which is exactly midnight UCT. The fact that the test retrieves all recorded searches for *today* makes it break at exactly midnight when the first search was done on the previous day.
Created attachment 774218
make browser_aboutHome.js not fail if it starts before but runs past midnight

Ok, here's what I did:

* I combined two tests. They did exactly the same (i.e. perform a search on about:home) but the second one checked if that search was recorded. I don't think we need two tests for this.

* Instead of expecting exactly one search being recorded, I retrieve the current number of recorded searches and expect it to be increased by one. This makes the test not fail should we add another one in the future that performs an about:home search and runs before browser_aboutHome.js.

* To make the test not fail when it runs past midnight it now adds the number of searches recorded yesterday to the number of searches recorded today. Normally, there are no searches done yesterday. Should the test run past midnight we'll just add the ones from the day before.
Created attachment 774220
make browser_aboutHome.js not fail if it starts before but runs past midnight, v2

Sorry, forgot to remove some debug stuff.
Comment on attachment 774220
make browser_aboutHome.js not fail if it starts before but runs past midnight, v2

Review of attachment 774220:
-----------------------------------------------------------------

::: browser/base/content/test/browser_aboutHome.js
@@ +106,5 @@
>      let doc = gBrowser.contentDocument;
>  
>      // We rely on the listener in browser.js being installed and fired before
>      // this one. If this ever changes, we should add an executeSoon() or similar.
>      doc.addEventListener("AboutHomeSearchEvent", function onSearch(e) {

looks like you removed the test for e.detail, was that on purpose?

@@ +119,5 @@
> +    // Get the current number of recorded searches.
> +    getNumberOfSearches().then(num => {
> +      numSearchesBefore = num;
> +
> +      // Perform a search.

Could you please replace this comment with an info(), in case of timeouts it's a nicer output
(In reply to Marco Bonardo [:mak] from comment #6)
> >      // We rely on the listener in browser.js being installed and fired before
> >      // this one. If this ever changes, we should add an executeSoon() or similar.
> >      doc.addEventListener("AboutHomeSearchEvent", function onSearch(e) {
> 
> looks like you removed the test for e.detail, was that on purpose?

No, will re-add.

> @@ +119,5 @@
> > +    // Get the current number of recorded searches.
> > +    getNumberOfSearches().then(num => {
> > +      numSearchesBefore = num;
> > +
> > +      // Perform a search.
> 
> Could you please replace this comment with an info(), in case of timeouts
> it's a nicer output

Good point, will do.
https://hg.mozilla.org/integration/fx-team/rev/6554c78cf049
https://hg.mozilla.org/mozilla-central/rev/6554c78cf049
https://hg.mozilla.org/releases/mozilla-beta/rev/d6a2aac75db2


Intermittent browser_aboutHome.js | Have searches recorded. - Got 1, expected 2

intermittent-failure

Bug 867550 - Make browser_aboutHome.js not fail if it starts before but runs past midnight; r=mak 