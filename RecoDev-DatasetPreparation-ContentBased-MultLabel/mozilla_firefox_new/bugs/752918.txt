Created attachment 621984
Patch converts SVG masks to clipPath elements. Need profiling.

per Roc: I think we might also be able to replace the SVG mask with an SVG clip-path. clip-path should be significantly more efficient since it doesn't require per-pixel luminance calculations.

Created attachment 621984
Patch converts SVG masks to clipPath elements. Need profiling.

per Roc: I think we might also be able to replace the SVG mask with an SVG clip-path. clip-path should be significantly more efficient since it doesn't require per-pixel luminance calculations.
Comment on attachment 621984
Patch converts SVG masks to clipPath elements. Need profiling.

I don't know anything about our theme stuff, Dao should be the person looking at this.
Comment on attachment 621984
Patch converts SVG masks to clipPath elements. Need profiling.

You need to update browser/themes/winstripe/browser.css too.

nit: please replace "-mask" with "-clipPath" in the SVG node ids.
Created attachment 622694
Final patch per feedback comments. r=dao

Addresses feedback comments. Need a final r+ prior to landing.
Created attachment 622902
screenshot of winstripe-urlbar-back-button-mask (above) and ...-clip-path (below)

Note the pixels bleeding through behind the back button especially at the bottom. It looks like the clip path is misaligned or doesn't quite have the right shape.
Created attachment 623087
Patch converts SVG masks to clipPath elements.

This patch includes clip-paths that very precisely follow the outlines of the original mask shapes they replace. This should resolve any compositing bleed issues.
Created attachment 623098
This patch reduces precision for less verbose SVG code.

This patch simplifies the paths, reduces precision for less verbose SVG markup. Note: this SVG is generated by the Inkscape SVG editor.
Comment on attachment 623098
This patch reduces precision for less verbose SVG code.

Thanks!
http://hg.mozilla.org/integration/mozilla-inbound/rev/ec19a7304528
https://hg.mozilla.org/mozilla-central/rev/ec19a7304528
It looks like this caused a 2% regression in the Talos SVG benchmark, at least on Mac OS X 10.6:
http://graphs.mozilla.org/graph.html#tests=[[22,63,21]]&sel=1336616135166,1337220935166

Should it be backed out?
I don't believe that's possible :-)
*** Bug 589983 has been marked as a duplicate of this bug. ***


Convert expensive SVG masks to clip-paths

perf

Bug 752918 - Convert expensive SVG masks to clip-paths. r=dao 

https://hg.mozilla.org/integration/gaia-central/rev/e42f752918fa